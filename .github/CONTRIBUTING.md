# Branching strategy

The main branches are as follows

- `main` - The main branch
- `develop` - The develop branch
- `main-dist` - The main branch with all checkout assets prepared for distribution. This branch is never committed to or checked out directly.
- `develop-dist` - The develop branch with all checkout assets prepared for distribution. This branch is never committed to or checked out directly.

For feature work
- Branch off `develop`
- Merge to `develop`
- Wait for the github action to generate `develop-dist` for testing, test it.
- When the release candidate is ready it can be merged to `main`
- Wait for the github action to generate `main-dist`
- Tag `main-dist` as the new version

For hotfixes to the current main tag
- Branch off of `main`
- Merge to `develop` 
- Wait for the github action to generate `develop-dist` for testing, test it.
- Merge to `main`
- Wait for the github action to generate `main-dist`
- Tag `main-dist` as the new version

For hotfixes from an older tag
- Find the tag you need to hotfix
- Branch off of the sha detailed in `.github/sha.txt`, this is the clean version the dist was generated from
- Call your branch `hotfix/abc123`
- This will generate `hotfix/abc123-dist`
- At this point you will be able to have the flexibility to do what you need, either tagging a `-p1` off that tag or merging it into `main` etc

# Making a release

1. Get your release into `main`
2. Verify that the `main-dist` has been generated by the github action
3. Go to https://github.com/genecommerce/module-better-checkout/releases
4. "Draft a new release"
5. Choose your tag (https://semver.org/) 
6. Pick the target `main-dist`
7. Hit "Generate Release Notes"
8. Tidy up the release notes as needed and "Publish release"

# Local workflow

When building the checkout locally you do not have the `dist`, so you will have to 
```bash
cd view/frontend/web/js/checkout/
npm ci
npm run build
```

This will populate `view/frontend/web/js/checkout/dist` for use.

You can make your changes and re-run `npm run build` to check them.

When your PR gets merged to `develop` or `main` it will automatically have the `dist` generated in the appropriate branch.